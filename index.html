<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能工资计算器</title>
    <style>
        :root {
            --primary-color: #2196F3;
            --half-color: #FFC107;
            --rest-color: #9E9E9E;
            --total-color: #ff4444; 
            --default-status: #e0e0e0;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 10px;
            background: #f0f2f5;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }
              
                /*标题背景色修改 */               
        .page-title {
        text-align: center;
        color: white;  /* 修改文字颜色为白色 */
        margin: 20px 0;
        font-size: 24px;
        font-weight: bold;
        padding: 15px;
        background: linear-gradient(135deg, #FF9800, #FF5722); /* 添加渐变色背景 */
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2); /* 加深阴影 */
        text-shadow: 1px 1px 2px rgba(0,0,0,0.3); /* 添加文字阴影 */
        transition: all 0.3s ease; /* 添加过渡动画 */
    }

    /* 添加悬停效果 */
    .page-title:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0,0,0,0.25);
    }

        .mode-switch {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }

        .mode-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            background: #e0e0e0;
            color: #666;
            cursor: pointer;
        }

        .mode-btn.active {
            background: var(--primary-color);
            color: white;
        }

        .date-controls {
            display: none;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
            margin-bottom: 10px;
        }

        .date-controls.active {
            display: grid;
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            background: white;
            padding: 5px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .day-box {
            min-height: 70px;
            padding: 5px;
            border: 1px solid #eee;
            position: relative;
            overflow: hidden;
        }

        .day-content {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 5px;
        }

        .day-num {
            font-size: 14px;
            font-weight: bold;
            color: #666;
        }

        .day-status {
            font-size: 12px;
            padding: 2px 5px;
            border-radius: 3px;
            width: 100%;
            text-align: center;
            background: var(--default-status);
            transition: background 0.2s;
        }

        .status-full { background: var(--primary-color); color: white; }
        .status-half { background: var(--half-color); color: black; }
        .status-rest { background: var(--rest-color); color: white; }

        .day-expense {
            font-size: 9px;
            color: #666;
            width: 100%;
            text-align: center;
            word-break: break-all;
            min-height: 15px;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.3);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .edit-modal {
            background: white;
            padding: 20px;
            border-radius: 10px;
            width: 85%;
        }

        .status-options {
            margin-bottom: 15px;
        }

        .status-option {
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
            background: var(--default-status);
            color: #666;
        }

        .status-option.selected {
            color: white !important;
        }
        .status-option.selected.status-full { background: var(--primary-color); }
        .status-option.selected.status-half { background: var(--half-color); color: black; }
        .status-option.selected.status-rest { background: var(--rest-color); }

        .stats-panel {
            background: white;
            padding: 15px;
            margin-top: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .stat-value {
            flex: 1;
            padding-left: 15px;
            text-align: left;
            min-width: 100px;
        }
       /* 修改日工单价输入框宽度 */

        #dailyWageInput {
    width: 80px; /* 加宽输入框 */
    padding: 5px 8px;
    border: 1px solid #ddd;
    border-radius: 5px;
    text-align: left;
    -moz-appearance: textfield; /* 新增：隐藏Firefox调节按钮 */
}

        .total-sum {
    color: #ff4444;  /* 原为var(--total-color) */
    font-weight: bold;
}

        .reset-btn {
            width: 100%;
            padding: 12px;
            background: #ff4444;
            color: white;
            border: none;
            border-radius: 8px;
            margin-top: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .reset-btn:hover {
            background: #cc0000;
        }

        #expenseInput {
            width: 100%;
            padding: 8px;
            margin-top: 10px;
            box-sizing: border-box;
        }

       /* 在原有CSS底部添加如下新规则 */
#dailyWageInput::-webkit-outer-spin-button,
#dailyWageInput::-webkit-inner-spin-button {
    -webkit-appearance: none; /* 隐藏Chrome/Safari调节按钮 */
    margin: 0;
}
    </style>
</head>
<body>
    <div class="container">
        <h1 class="page-title">智能工资计算器</h1>

        <div class="mode-switch">
            <button class="mode-btn active" onclick="switchMode('month')">按月计算</button>
            <button class="mode-btn" onclick="switchMode('custom')">自定义日期</button>
        </div>

        <div class="date-controls active" id="monthControl">
            <input type="month" id="currentMonth">
        </div>

        <div class="date-controls" id="customControl">
            <input type="date" id="startDate">
            <input type="date" id="endDate">
        </div>

        <div class="calendar" id="calendar"></div>

        <div class="stats-panel">
            <div class="stat-item">
                <span>日工单价：</span>
                <div class="stat-value">
                    <input type="text" id="dailyWageInput" value="400元">
                </div>
            </div>
            <div class="stat-item">
                <span>工作日期：</span>
                <div class="stat-value">
                    <span id="workDateRange">-</span>
                </div>
            </div>

            <div class="stat-item">
                <span>工作天数：</span>
                <div class="stat-value">
                    <span id="workDays">0</span>
                </div>
            </div>
            <div class="stat-item">
                <span>工资总额：</span>
                <div class="stat-value">
                    <span id="totalSalary">0.00</span> 元
                </div>
            </div>
            <div class="stat-item">
                <span>生活费用：</span>
                <div class="stat-value">
                    <span id="totalExpense">0.00</span> 元
                </div>
            </div>
            <div class="stat-item total-sum">
                <span>共计总额：</span>
                <div class="stat-value">
                    <span id="netIncome">0.00</span> 元
                </div>
            </div>
            <button class="reset-btn" onclick="resetData()">重置所有数据</button>
        </div>

        <div class="modal-overlay" id="editModal">
            <div class="edit-modal">
                <div class="status-options">
                    <div class="status-option status-full" onclick="selectStatus('full')">全天</div>
                    <div class="status-option status-half" onclick="selectStatus('half')">半天</div>
                    <div class="status-option status-rest" onclick="selectStatus('rest')">休息</div>
                </div>
                <div class="expense-input">
                    <input type="number" id="expenseInput" placeholder="输入当天生活费用">
                    <button onclick="saveData()" style="width:100%;padding:10px;margin-top:10px">保存</button>
                </div>
            </div>
        </div>
    </div>

    <script>
let records = JSON.parse(localStorage.getItem('workRecords')) || {};
let currentDate = new Date();
let selectedDateKey = null;

// 新增工资输入框事件处理
document.getElementById('dailyWageInput').addEventListener('focus', function() {
    this.value = this.value.replace('元', '');
});

document.getElementById('dailyWageInput').addEventListener('blur', function() {
    let value = this.value.replace(/[^0-9.]/g, '');
    if (value === '') value = '0';
    this.value = parseFloat(value).toFixed(0) + '元';
    calculateStats();
});

function generateCalendar(year, month) {
    const calendar = document.getElementById('calendar');
    calendar.innerHTML = '';
    
    const date = new Date(year, month);
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    const firstDay = date.getDay();

    ['日', '一', '二', '三', '四', '五', '六'].forEach(d => {
        const day = document.createElement('div');
        day.className = 'day-box';
        day.innerHTML = `<div class="day-content" style="color:#666;font-weight:bold">${d}</div>`;
        calendar.appendChild(day);
    });

    for(let i = 0; i < firstDay; i++) {
        const emptyDay = document.createElement('div');
        emptyDay.className = 'day-box';
        calendar.appendChild(emptyDay);
    }

    for(let d = 1; d <= daysInMonth; d++) {
        const dateKey = `${year}-${pad(month+1)}-${pad(d)}`;
        const day = document.createElement('div');
        day.className = 'day-box';
        day.onclick = () => showEditModal(dateKey);
        
        const record = records[dateKey] || {};
        day.innerHTML = `
            <div class="day-content">
                <div class="day-num">${d}</div>
                <div class="day-status ${record.status ? 'status-' + record.status : ''}">
                    ${getStatusText(record.status)}
                </div>
                <div class="day-expense">${record.expense ? '¥' + record.expense : ''}</div>
            </div>
        `;
        calendar.appendChild(day);
    }
}

function showEditModal(dateKey) {
    selectedDateKey = dateKey;
    const record = records[dateKey] || {};
    document.getElementById('expenseInput').value = record.expense || '';
    document.querySelectorAll('.status-option').forEach(opt => {
        opt.classList.remove('selected');
        if (opt.classList.contains(`status-${record.status}`)) {
            opt.classList.add('selected');
        }
    });
    document.getElementById('editModal').style.display = 'flex';
}

function saveData() {
    const status = document.querySelector('.status-option.selected')?.classList[1].split('-')[1];
    const expense = parseFloat(document.getElementById('expenseInput').value) || 0;

    if (selectedDateKey) {
        if (status) {
            records[selectedDateKey] = {
                status: status,
                expense: expense
            };
        } else {
            delete records[selectedDateKey];
        }
        saveAndUpdate();
    }
    document.getElementById('editModal').style.display = 'none';
}

function selectStatus(status) {
    document.querySelectorAll('.status-option').forEach(opt => 
        opt.classList.remove('selected'));
    event.target.classList.add('selected');
}

function calculateStats() {
    const dailyWage = parseFloat(
        document.getElementById('dailyWageInput').value.replace('元', '')
    ) || 0;
    let workDays = 0, totalExpense = 0;

    // 日期范围逻辑
    let dateRangeText = '-';
    let startDate, endDate;

    try {
        const activeModeBtn = document.querySelector('.mode-btn.active');
        const mode = activeModeBtn.getAttribute('onclick').includes('month') ? 'month' : 'custom';
        
        if (mode === 'month') {
            const monthValue = document.getElementById('currentMonth').value;
            const [year, month] = monthValue.split('-').map(Number);
            startDate = new Date(year, month - 1, 1);
            endDate = new Date(year, month, 0);
            dateRangeText = `${year}年${pad(month)}月`;
        } else {
            const startStr = document.getElementById('startDate').value;
            const endStr = document.getElementById('endDate').value;
            startDate = new Date(startStr);
            endDate = new Date(endStr);
            dateRangeText = `${startStr} 至 ${endStr}`;
        }
        endDate.setHours(23, 59, 59, 999);
    } catch (e) {
        console.error('日期解析错误:', e);
    }

    document.getElementById('workDateRange').textContent = dateRangeText;

    // 过滤日期范围内的记录
    Object.entries(records).forEach(([dateKey, record]) => {
        const currentDate = new Date(dateKey);
        if (currentDate >= startDate && currentDate <= endDate) {
            if (record.status === 'full') workDays += 1;
            else if (record.status === 'half') workDays += 0.5;
            totalExpense += parseFloat(record.expense) || 0;
        }
    });

    const displayDays = workDays % 1 === 0 ? workDays : workDays.toFixed(1);
    const totalSalary = workDays * dailyWage;
    const totalSum = totalSalary + totalExpense;

    document.getElementById('workDays').textContent = displayDays;
    document.getElementById('totalSalary').textContent = totalSalary.toFixed(2);
    document.getElementById('totalExpense').textContent = totalExpense.toFixed(2);
    document.getElementById('netIncome').textContent = totalSum.toFixed(2);
}

function pad(n) { return n.toString().padStart(2, '0'); }
function getStatusText(s) { return { full: '全', half: '半', rest: '休' }[s] || ''; }
function saveAndUpdate() {
    localStorage.setItem('workRecords', JSON.stringify(records));
    generateCalendar(currentDate.getFullYear(), currentDate.getMonth());
    calculateStats();
}

// 月份切换事件
document.getElementById('currentMonth').value = 
    `${currentDate.getFullYear()}-${pad(currentDate.getMonth()+1)}`;
document.getElementById('currentMonth').addEventListener('change', function() {
    const [year, month] = this.value.split('-').map(Number);
    currentDate = new Date(year, month-1);
    generateCalendar(year, month-1);
    calculateStats();
});

// 初始化事件监听
document.addEventListener('DOMContentLoaded', () => {
    generateCalendar(currentDate.getFullYear(), currentDate.getMonth());
    calculateStats();
    
    document.getElementById('dailyWageInput').addEventListener('input', function() {
        calculateStats();
    });
    document.getElementById('startDate').addEventListener('change', calculateStats);
    document.getElementById('endDate').addEventListener('change', calculateStats);
});

// 模式切换函数
function switchMode(mode) {
    document.querySelectorAll('.mode-btn').forEach(btn => 
        btn.classList.remove('active'));
    document.getElementById('monthControl').style.display = mode === 'month' ? 'grid' : 'none';
    document.getElementById('customControl').style.display = mode === 'custom' ? 'grid' : 'none';
    document.querySelector(`button[onclick="switchMode('${mode}')"]`)
        .classList.add('active');
    calculateStats();
}

window.onclick = function(event) {
    if (event.target.classList.contains('modal-overlay')) {
        event.target.style.display = 'none';
    }
}

function resetData() {
    if(confirm('确定要清空所有记录吗？此操作不可恢复！')) {
        localStorage.removeItem('workRecords');
        records = {};
        document.getElementById('dailyWageInput').value = '400元'; // 添加单位
        generateCalendar(currentDate.getFullYear(), currentDate.getMonth());
        calculateStats();
    }
}
</script>
</body>
</html>